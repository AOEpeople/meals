{% set dish = meal.dish %}
{% set combinedDish = '0' %}
{% set combinedDishIDs = '' %}
{% set bookedDishTitles = [] %}
{% set participant = meal.getParticipant(app.user.profile) %}
{% set dishDescription = dish.description|default('content.participation.dish.no_description'|trans({},'general')) %}

{% if dish.isCombinedDish %}
    {% set combinedDish = '1' %}
    {% set bookedDishCombination = participationService.getBookedDishCombination(app.user.profile, meal) %}
    {% if bookedDishCombination|length > 0 %}
        {% set bookedDishTitles = bookedDishCombination.toArray|map(d => d.title) %}
        {% set combinedDishIDs = bookedDishCombination.toArray|map(d => d.slug)|join(',') %}
    {% endif %}
{% endif %}

<div class="meal-row{{ combinedDish === '1' ? 'combined-meal' }} "
    {%- if available -%}
        data-id="{{ participant ? participant.id }}"
        data-combined="{{ combinedDish }}"
        data-slug="{{ dish.slug }}"
        data-booked-dishes="{{ combinedDishIDs }}"
        data-join-url="{{ link(meal, 'join') }}"
        data-description="{{ dishDescription }}"
    {%- endif -%}
    >
    <div class="title{{ available and bookedDishTitles|length ? ' edit' }}">
        {{- dish.title -}}
        {%- if dishService.isNew(dish) %}
            <span class="new-flag">{{ 'content.participation.dish.new'|trans({},'general') }}</span>
        {% endif -%}
    </div>
    <div class="description">
        <div class="text dish-combination">
            {% for dishTitle in bookedDishTitles %}
                <div class="dish">{{ dishTitle }}</div>
            {% else %}
                {{ dishDescription }}
            {% endfor %}
        </div>
        <div class="text price">{{ meal.price|number_format(2, '.', ',') }} â‚¬</div>
    </div>
    {% include 'MealzMealBundle:Meal/partials:mealActionsWrapper.html.twig' %}
</div>
