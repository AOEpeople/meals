<div class="meal-row"
    data-attribute-selected-dish="{{ parentDish }}"
    data-attribute-selected-variations="{% if selectedDish != null and parentDish != selectedDish.0 %}{{ selectedDish | json_encode}}{% endif %}"
>
    {% set formMeals = reloadFormMeals() %}

    {% if selectedDish is not null %}
        {% set formViews = getGroupedFormViews(selectedDish, formMeals) %}
    {% elseif parentDish is not null %}
        {% set formViews = getGroupedFormViews(parentDish, formMeals) %}
    {% else %}
        {% set formViews = [formMeals|first] %}
    {% endif %}

    {{ removeUsedFormViews(formMeals, formViews) }}

    {% for formView in formViews %}
        {% if formView is iterable %}
            {{ form_widget(formView, { 'attr': {'class': 'meal-selected'} }) }}
        {% endif %}
    {% endfor %}

    <div class="meal-select-box">
        <ul>
            {% set currentCategory = '' %}
            {% for dish in dishes %}
                {% set category = dish.category %}
                {% if category is not null and category.id != currentCategory %}
                    <li class="category">
                        Category: {{ category.title }}
                    </li>
                    {% set currentCategory = category.id %}
                {% endif %}
                {% set variations = dish.variations %}
                {% if not dish.parent %}
                    <li class="dishes" data-attribute-id="{{ dish.id }}" data-attribute-parent="{% if variations|length > 0 %}{% spaceless %}true{% endspaceless %}{% endif %}">
                        <span class="dish-title">{{ dish.title }}</span>
                        {% if variations|length > 0 %}
                            <div class="variation-button">variations</div>
                            <div class="meal-select-variations">
                                {% for variation in variations %}
                                    <div class="variation" data-attribute-id="{{ variation.id }}">
                                        <div class="variation-checkbox {% if variation.id in selectedDish %}checked{% endif %}"></div>
                                        <label for="variation">{{ variation.title }}</label>
                                    </div>
                                {% endfor %}
                                <a href="#" class="button small">save</a>
                            </div>
                        {% endif %}
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    <div class="meal-select">
        <span class="meal-label">{{ getFullTitleByDishAndVariation(parentDish , selectedDish, dishes) }}</span>
        {% if formViews|first.vars.value.dish != null %}
            <a class="remove-meal" href="#"><span class="glyphicon glyphicon-remove"></span></a>
        {% endif %}
    </div>
</div>